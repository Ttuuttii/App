<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0a0a0a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>FitPro Trainer Premium</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #141414;
            --bg-card: #1a1a1a;
            --bg-elevated: #222222;
            --accent-primary: #00d4ff;
            --accent-secondary: #7c3aed;
            --accent-gradient: linear-gradient(135deg, #00d4ff 0%, #7c3aed 100%);
            --text-primary: #ffffff;
            --text-secondary: #a0a0a0;
            --text-tertiary: #666666;
            --border-color: #2a2a2a;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            padding-bottom: 80px;
            line-height: 1.6;
        }
        
        .header {
            background: var(--bg-secondary);
            backdrop-filter: blur(20px);
            padding: 20px 24px;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid var(--border-color);
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 24px;
            font-weight: 700;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .logo-icon {
            width: 40px;
            height: 40px;
            background: var(--accent-gradient);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        
        .container {
            padding: 32px 24px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .nav-tabs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            margin-bottom: 32px;
            background: var(--bg-card);
            padding: 8px;
            border-radius: 16px;
            border: 1px solid var(--border-color);
        }
        
        .nav-tab {
            padding: 14px 20px;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 12px;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .nav-tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--accent-gradient);
            opacity: 0;
            transition: opacity 0.3s;
            z-index: -1;
        }
        
        .nav-tab.active {
            color: var(--text-primary);
            transform: translateY(-2px);
        }
        
        .nav-tab.active::before {
            opacity: 1;
        }
        
        .nav-tab:hover:not(.active) {
            color: var(--text-primary);
            background: var(--bg-elevated);
        }
        
        .tab-content {
            display: none;
            animation: fadeInUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .card {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 28px;
            margin-bottom: 24px;
            border: 1px solid var(--border-color);
            transition: all 0.3s;
        }
        
        .card:hover {
            border-color: var(--accent-primary);
            box-shadow: 0 8px 32px rgba(0, 212, 255, 0.1);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .card-title {
            font-size: 24px;
            font-weight: 700;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .btn:active::before {
            width: 300px;
            height: 300px;
        }
        
        .btn-primary {
            background: var(--accent-gradient);
            color: var(--text-primary);
            box-shadow: 0 4px 20px rgba(0, 212, 255, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0, 212, 255, 0.4);
        }
        
        .btn-secondary {
            background: var(--bg-elevated);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }
        
        .btn-secondary:hover {
            background: var(--bg-card);
            border-color: var(--accent-primary);
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-icon {
            padding: 10px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .form-control {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 15px;
            transition: all 0.3s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--accent-primary);
            background: var(--bg-card);
            box-shadow: 0 0 0 4px rgba(0, 212, 255, 0.1);
        }
        
        textarea.form-control {
            min-height: 120px;
            resize: vertical;
            font-family: inherit;
        }
        
        select.form-control {
            cursor: pointer;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }
        
        .stat-card {
            background: var(--bg-card);
            padding: 28px;
            border-radius: 20px;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
            transition: all 0.3s;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--accent-gradient);
        }
        
        .stat-card:hover {
            transform: translateY(-4px);
            border-color: var(--accent-primary);
            box-shadow: 0 12px 40px rgba(0, 212, 255, 0.15);
        }
        
        .stat-number {
            font-size: 42px;
            font-weight: 700;
            margin-bottom: 8px;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .stat-label {
            font-size: 14px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }
        
        .client-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
        }
        
        .client-card {
            background: var(--bg-card);
            padding: 24px;
            border-radius: 16px;
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .client-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--accent-gradient);
            transform: scaleY(0);
            transition: transform 0.3s;
        }
        
        .client-card:hover {
            transform: translateX(8px);
            border-color: var(--accent-primary);
            box-shadow: 0 8px 32px rgba(0, 212, 255, 0.15);
        }
        
        .client-card:hover::before {
            transform: scaleY(1);
        }
        
        .client-avatar {
            width: 60px;
            height: 60px;
            border-radius: 16px;
            background: var(--accent-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 16px;
            color: white;
        }
        
        .client-name {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--text-primary);
        }
        
        .client-info {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            z-index: 1000;
            overflow-y: auto;
            padding: 20px;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: var(--bg-card);
            border-radius: 24px;
            padding: 36px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(40px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 28px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .close-btn {
            background: var(--bg-elevated);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            transition: all 0.3s;
        }
        
        .close-btn:hover {
            background: var(--danger);
            color: white;
            border-color: var(--danger);
            transform: rotate(90deg);
        }
        
        .plan-section {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }
        
        .plan-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .plan-section-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--accent-primary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .exercise-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .exercise-item {
            background: var(--bg-card);
            padding: 16px;
            border-radius: 12px;
            border-left: 3px solid var(--accent-primary);
            display: grid;
            gap: 8px;
        }
        
        .exercise-name {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 15px;
        }
        
        .exercise-details {
            font-size: 13px;
            color: var(--text-secondary);
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }
        
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            gap: 6px;
        }
        
        .badge-primary {
            background: rgba(0, 212, 255, 0.15);
            color: var(--accent-primary);
            border: 1px solid rgba(0, 212, 255, 0.3);
        }
        
        .badge-success {
            background: rgba(16, 185, 129, 0.15);
            color: var(--success);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        
        .badge-warning {
            background: rgba(245, 158, 11, 0.15);
            color: var(--warning);
            border: 1px solid rgba(245, 158, 11, 0.3);
        }
        
        .badge-purple {
            background: rgba(124, 58, 237, 0.15);
            color: var(--accent-secondary);
            border: 1px solid rgba(124, 58, 237, 0.3);
        }
        
        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: var(--text-tertiary);
        }
        
        .empty-icon {
            font-size: 80px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        .empty-state h3 {
            font-size: 24px;
            margin-bottom: 12px;
            color: var(--text-secondary);
        }
        
        .action-bar {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        .test-card {
            background: var(--bg-card);
            padding: 24px;
            border-radius: 16px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            transition: all 0.3s;
        }
        
        .test-card:hover {
            border-color: var(--accent-primary);
            transform: translateY(-2px);
        }
        
        .test-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 20px;
        }
        
        .test-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }
        
        .test-results {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid var(--accent-primary);
            margin: 16px 0;
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
        }
        
        .result-item:last-child {
            border-bottom: none;
        }
        
        .result-label {
            font-weight: 600;
            color: var(--text-secondary);
        }
        
        .result-value {
            font-weight: 700;
            color: var(--accent-primary);
            font-size: 18px;
        }
        
        .note-card {
            background: var(--bg-card);
            padding: 24px;
            border-radius: 16px;
            margin-bottom: 20px;
            border-left: 4px solid var(--warning);
            border-top: 1px solid var(--border-color);
            border-right: 1px solid var(--border-color);
            border-bottom: 1px solid var(--border-color);
            transition: all 0.3s;
        }
        
        .note-card:hover {
            transform: translateX(4px);
            box-shadow: 0 8px 24px rgba(245, 158, 11, 0.15);
        }
        
        .note-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 16px;
        }
        
        .note-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .note-meta {
            font-size: 13px;
            color: var(--text-tertiary);
            margin-bottom: 12px;
        }
        
        .note-content {
            color: var(--text-secondary);
            line-height: 1.8;
            white-space: pre-wrap;
        }
        
        .plan-card {
            background: var(--bg-card);
            padding: 28px;
            border-radius: 20px;
            margin-bottom: 24px;
            border: 1px solid var(--border-color);
            transition: all 0.3s;
        }
        
        .plan-card:hover {
            border-color: var(--accent-primary);
            box-shadow: 0 12px 40px rgba(0, 212, 255, 0.12);
        }
        
        .plan-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 24px;
        }
        
        .plan-title {
            font-size: 22px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }
        
        .week-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            overflow-x: auto;
            padding: 4px;
        }
        
        .week-tab {
            padding: 10px 20px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            color: var(--text-secondary);
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 13px;
        }
        
        .week-tab.active {
            background: var(--accent-gradient);
            border-color: transparent;
            color: white;
            box-shadow: 0 4px 12px rgba(0, 212, 255, 0.3);
        }
        
        .day-section {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 16px;
            border: 1px solid var(--border-color);
        }
        
        .day-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--accent-primary);
            margin-bottom: 16px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        @media print {
            body {
                background: white;
                color: black;
            }
            .header, .nav-tabs, .btn, .action-bar {
                display: none !important;
            }
            .card, .plan-card {
                break-inside: avoid;
                border: 1px solid #ddd;
                page-break-inside: avoid;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 20px 16px;
            }
            .card {
                padding: 20px;
            }
            .modal-content {
                padding: 24px;
            }
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .client-grid {
                grid-template-columns: 1fr;
            }
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">💪</div>
                <span>FitPro Premium</span>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('dashboard')">📊 Dashboard</button>
            <button class="nav-tab" onclick="switchTab('clients')">👥 Clientes</button>
            <button class="nav-tab" onclick="switchTab('plans')">📋 Planes</button>
            <button class="nav-tab" onclick="switchTab('tests')">📈 Tests</button>
            <button class="nav-tab" onclick="switchTab('notes')">📝 Notas</button>
        </div>

        <!-- Dashboard -->
        <div id="dashboard" class="tab-content active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalClients">0</div>
                    <div class="stat-label">Clientes Activos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalPlans">0</div>
                    <div class="stat-label">Planes Creados</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalTests">0</div>
                    <div class="stat-label">Tests Realizados</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalNotes">0</div>
                    <div class="stat-label">Notas Guardadas</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Actividad Reciente</h2>
                </div>
                <div id="recentActivity"></div>
            </div>
        </div>

        <!-- Clientes -->
        <div id="clients" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Gestión de Clientes</h2>
                    <button class="btn btn-primary" onclick="openClientModal()">
                        <span>+</span> Nuevo Cliente
                    </button>
                </div>
                <div class="client-grid" id="clientList"></div>
            </div>
        </div>

        <!-- Planes -->
        <div id="plans" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Planes de Entrenamiento</h2>
                    <button class="btn btn-primary" onclick="openPlanModal()">
                        <span>+</span> Crear Plan
                    </button>
                </div>
                <div id="planList"></div>
            </div>
        </div>

        <!-- Tests -->
        <div id="tests" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Tests y Evaluaciones Fitness</h2>
                    <button class="btn btn-primary" onclick="openTestModal()">
                        <span>+</span> Registrar Test
                    </button>
                </div>
                <div id="testList"></div>
            </div>
        </div>

        <!-- Notas -->
        <div id="notes" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Notas y Apuntes</h2>
                    <button class="btn btn-primary" onclick="openNoteModal()">
                        <span>+</span> Nueva Nota
                    </button>
                </div>
                <div id="noteList"></div>
            </div>
        </div>
    </div>

    <!-- Modal Cliente -->
    <div id="clientModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="card-title">Nuevo Cliente</h2>
                <button class="close-btn" onclick="closeModal('clientModal')">&times;</button>
            </div>
            <form id="clientForm" onsubmit="saveClient(event)">
                <div class="form-group">
                    <label class="form-label">Nombre Completo *</label>
                    <input type="text" class="form-control" name="name" required>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" name="email">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Teléfono</label>
                        <input type="tel" class="form-control" name="phone">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Edad</label>
                        <input type="number" class="form-control" name="age">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Peso (kg)</label>
                        <input type="number" step="0.1" class="form-control" name="weight">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Altura (cm)</label>
                        <input type="number" class="form-control" name="height">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Objetivo Principal</label>
                    <select class="form-control" name="goal">
                        <option value="">Seleccionar...</option>
                        <option value="perdida_peso">Pérdida de peso</option>
                        <option value="ganancia_muscular">Ganancia muscular</option>
                        <option value="resistencia">Mejorar resistencia</option>
                        <option value="fuerza">Aumentar fuerza</option>
                        <option value="rehabilitacion">Rehabilitación</option>
                        <option value="rendimiento">Rendimiento deportivo</option>
                        <option value="tonificacion">Tonificación</option>
                        <option value="otro">Otro</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Notas Adicionales</label>
                    <textarea class="form-control" name="notes" placeholder="Lesiones, preferencias, historial médico relevante..."></textarea>
                </div>
                
                <div class="action-bar">
                    <button type="submit" class="btn btn-primary">💾 Guardar Cliente</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('clientModal')">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Plan Detallado -->
    <div id="planModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2 class="card-title">Crear Plan de Entrenamiento</h2>
                <button class="close-btn" onclick="closeModal('planModal')">&times;</button>
            </div>
            <form id="planForm" onsubmit="savePlan(event)">
                <div class="form-group">
                    <label class="form-label">Cliente *</label>
                    <select class="form-control" name="clientId" id="planClientSelect" required>
                        <option value="">Seleccionar cliente...</option>
                    </select>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Tipo de Plan *</label>
                        <select class="form-control" name="type" required>
                            <option value="individual">Individual</option>
                            <option value="grupal">Grupal</option>
                            <option value="deportivo">Deportivo</option>
                            <option value="rehabilitacion">Rehabilitación</option>
                            <option value="fuerza">Fuerza</option>
                            <option value="hipertrofia">Hipertrofia</option>
                            <option value="resistencia">Resistencia</option>
                            <option value="funcional">Funcional</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Duración *</label>
                        <select class="form-control" name="duration" required onchange="updateWeekInputs()">
                            <option value="1">1 Semana</option>
                            <option value="2">2 Semanas</option>
                            <option value="4">4 Semanas (1 Mes)</option>
                            <option value="8">8 Semanas (2 Meses)</option>
                            <option value="12">12 Semanas (3 Meses)</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Objetivo del Plan</label>
                    <input type="text" class="form-control" name="objective" placeholder="Ej: Aumentar fuerza en tren superior">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Descripción General</label>
                    <textarea class="form-control" name="description" placeholder="Descripción general del plan, metodología, progresiones..."></textarea>
                </div>
                
                <div id="weekSections"></div>
                
                <div class="form-group">
                    <label class="form-label">Notas del Entrenador</label>
                    <textarea class="form-control" name="notes" placeholder="Observaciones importantes, ajustes, recomendaciones..."></textarea>
                </div>
                
                <div class="action-bar">
                    <button type="submit" class="btn btn-primary">💾 Guardar Plan</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('planModal')">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Test -->
    <div id="testModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="card-title">Registrar Test Fitness</h2>
                <button class="close-btn" onclick="closeModal('testModal')">&times;</button>
            </div>
            <form id="testForm" onsubmit="saveTest(event)">
                <div class="form-group">
                    <label class="form-label">Cliente *</label>
                    <select class="form-control" name="clientId" id="testClientSelect" required>
                        <option value="">Seleccionar cliente...</option>
                    </select>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Tipo de Test *</label>
                        <select class="form-control" name="type" required>
                            <option value="composicion">Composición Corporal</option>
                            <option value="fuerza">Fuerza Máxima (RM)</option>
                            <option value="resistencia_muscular">Resistencia Muscular</option>
                            <option value="resistencia_cardio">Resistencia Cardiovascular</option>
                            <option value="flexibilidad">Flexibilidad</option>
                            <option value="velocidad">Velocidad/Agilidad</option>
                            <option value="potencia">Potencia</option>
                            <option value="antropometrico">Antropométrico</option>
                            <option value="funcional">Funcional</option>
                            <option value="otro">Otro</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Fecha del Test</label>
                        <input type="date" class="form-control" name="testDate" value="">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Nombre del Test *</label>
                    <input type="text" class="form-control" name="name" required placeholder="Ej: Test de Cooper, RM Press Banca, Test Sit & Reach">
                </div>
                
                <div id="testResultsSection">
                    <div class="form-group">
                        <label class="form-label">Resultados del Test *</label>
                        <div id="testResultFields"></div>
                        <button type="button" class="btn btn-secondary" onclick="addTestResultField()" style="margin-top: 10px;">
                            + Agregar Medición
                        </button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Observaciones y Análisis</label>
                    <textarea class="form-control" name="notes" placeholder="Análisis de los resultados, comparaciones con tests anteriores, recomendaciones..."></textarea>
                </div>
                
                <div class="action-bar">
                    <button type="submit" class="btn btn-primary">💾 Guardar Test</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('testModal')">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Nota -->
    <div id="noteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="card-title">Nueva Nota</h2>
                <button class="close-btn" onclick="closeModal('noteModal')">&times;</button>
            </div>
            <form id="noteForm" onsubmit="saveNote(event)">
                <div class="form-group">
                    <label class="form-label">Título *</label>
                    <input type="text" class="form-control" name="title" required placeholder="Título de la nota">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Cliente (opcional)</label>
                    <select class="form-control" name="clientId" id="noteClientSelect">
                        <option value="">Nota general (sin cliente asociado)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Contenido *</label>
                    <textarea class="form-control" name="content" required style="min-height: 200px;" placeholder="Escribe tu nota aquí..."></textarea>
                </div>
                
                <div class="action-bar">
                    <button type="submit" class="btn btn-primary">💾 Guardar Nota</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('noteModal')">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Detalle Cliente -->
    <div id="clientDetailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="card-title" id="clientDetailName"></h2>
                <button class="close-btn" onclick="closeModal('clientDetailModal')">&times;</button>
            </div>
            <div id="clientDetailContent"></div>
        </div>
    </div>

    <script>
        // Storage
        const storage = {
            get: (key) => {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : null;
            },
            set: (key, value) => {
                localStorage.setItem(key, JSON.stringify(value));
            }
        };

        // Data
        let clients = storage.get('clients') || [];
        let plans = storage.get('plans') || [];
        let tests = storage.get('tests') || [];
        let notes = storage.get('notes') || [];

        // Set today's date as default for test date
        document.addEventListener('DOMContentLoaded', () => {
            const dateInput = document.querySelector('input[name="testDate"]');
            if (dateInput) {
                dateInput.value = new Date().toISOString().split('T')[0];
            }
            addTestResultField(); // Add initial field
            updateWeekInputs(); // Initialize week sections
        });

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'dashboard') updateDashboard();
            if (tabName === 'clients') renderClients();
            if (tabName === 'plans') renderPlans();
            if (tabName === 'tests') renderTests();
            if (tabName === 'notes') renderNotes();
        }

        // Modal functions
        function openClientModal(client = null) {
            document.getElementById('clientModal').classList.add('active');
            if (client) {
                const form = document.getElementById('clientForm');
                form.name.value = client.name;
                form.email.value = client.email || '';
                form.phone.value = client.phone || '';
                form.age.value = client.age || '';
                form.weight.value = client.weight || '';
                form.height.value = client.height || '';
                form.goal.value = client.goal || '';
                form.notes.value = client.notes || '';
                form.dataset.editId = client.id;
            }
        }

        function openPlanModal() {
            document.getElementById('planModal').classList.add('active');
            updateClientSelects();
            updateWeekInputs();
        }

        function openTestModal() {
            document.getElementById('testModal').classList.add('active');
            updateClientSelects();
            const dateInput = document.querySelector('input[name="testDate"]');
            if (dateInput && !dateInput.value) {
                dateInput.value = new Date().toISOString().split('T')[0];
            }
        }

        function openNoteModal() {
            document.getElementById('noteModal').classList.add('active');
            updateClientSelects();
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
            if (modalId === 'clientModal') {
                const form = document.getElementById('clientForm');
                form.reset();
                delete form.dataset.editId;
            }
            if (modalId === 'planModal') document.getElementById('planForm').reset();
            if (modalId === 'testModal') {
                document.getElementById('testForm').reset();
                document.getElementById('testResultFields').innerHTML = '';
                addTestResultField();
            }
            if (modalId === 'noteModal') document.getElementById('noteForm').reset();
        }

        // Week sections for detailed plans
        function updateWeekInputs() {
            const duration = parseInt(document.querySelector('[name="duration"]').value) || 1;
            const container = document.getElementById('weekSections');
            container.innerHTML = '';
            
            for (let week = 1; week <= duration; week++) {
                const weekDiv = document.createElement('div');
                weekDiv.className = 'plan-section';
                weekDiv.innerHTML = `
                    <div class="plan-section-header">
                        <div class="plan-section-title">Semana ${week}</div>
                    </div>
                    ${generateDayInputs(week)}
                `;
                container.appendChild(weekDiv);
            }
        }

        function generateDayInputs(week) {
            const days = ['Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado', 'Domingo'];
            return days.map((day, index) => `
                <div class="form-group" style="margin-bottom: 16px;">
                    <label class="form-label">${day}</label>
                    <textarea class="form-control" name="week${week}_day${index + 1}" 
                        placeholder="Ejercicios del ${day}. Ej:&#10;1. Sentadilla: 4x8-10 reps&#10;2. Press Banca: 3x10 reps&#10;3. Peso Muerto: 4x6 reps&#10;&#10;O escribe 'Descanso' si es día de recuperación"></textarea>
                </div>
            `).join('');
        }

        // Test result fields
        function addTestResultField() {
            const container = document.getElementById('testResultFields');
            const fieldId = Date.now();
            const div = document.createElement('div');
            div.className = 'form-row';
            div.style.marginBottom = '12px';
            div.innerHTML = `
                <div class="form-group" style="margin-bottom: 0;">
                    <input type="text" class="form-control" name="resultLabel_${fieldId}" placeholder="Nombre de la medición (ej: Peso, % Grasa, RM Press Banca)">
                </div>
                <div class="form-group" style="margin-bottom: 0;">
                    <input type="text" class="form-control" name="resultValue_${fieldId}" placeholder="Valor (ej: 75kg, 15%, 100kg)">
                </div>
                <button type="button" class="btn btn-danger btn-icon" onclick="this.parentElement.remove()">×</button>
            `;
            container.appendChild(div);
        }

        // Save functions
        function saveClient(e) {
            e.preventDefault();
            const form = e.target;
            const formData = new FormData(form);
            
            const client = {
                id: form.dataset.editId || Date.now().toString(),
                name: formData.get('name'),
                email: formData.get('email'),
                phone: formData.get('phone'),
                age: formData.get('age'),
                weight: formData.get('weight'),
                height: formData.get('height'),
                goal: formData.get('goal'),
                notes: formData.get('notes'),
                createdAt: form.dataset.editId ? clients.find(c => c.id === form.dataset.editId).createdAt : new Date().toISOString()
            };

            if (form.dataset.editId) {
                const index = clients.findIndex(c => c.id === form.dataset.editId);
                clients[index] = client;
            } else {
                clients.push(client);
            }

            storage.set('clients', clients);
            closeModal('clientModal');
            renderClients();
            updateDashboard();
        }

        function savePlan(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const duration = parseInt(formData.get('duration'));
            
            const weeks = [];
            for (let week = 1; week <= duration; week++) {
                const days = [];
                for (let day = 1; day <= 7; day++) {
                    const content = formData.get(`week${week}_day${day}`);
                    if (content && content.trim()) {
                        days.push({
                            day: ['Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado', 'Domingo'][day - 1],
                            content: content.trim()
                        });
                    }
                }
                if (days.length > 0) {
                    weeks.push({ week, days });
                }
            }
            
            const plan = {
                id: Date.now().toString(),
                clientId: formData.get('clientId'),
                type: formData.get('type'),
                duration: duration,
                objective: formData.get('objective'),
                description: formData.get('description'),
                weeks: weeks,
                notes: formData.get('notes'),
                createdAt: new Date().toISOString()
            };

            plans.push(plan);
            storage.set('plans', plans);
            closeModal('planModal');
            renderPlans();
            updateDashboard();
        }

        function saveTest(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            
            const results = {};
            for (let [key, value] of formData.entries()) {
                if (key.startsWith('resultLabel_')) {
                    const id = key.split('_')[1];
                    const labelValue = value;
                    const resultValue = formData.get(`resultValue_${id}`);
                    if (labelValue && resultValue) {
                        results[labelValue] = resultValue;
                    }
                }
            }
            
            const test = {
                id: Date.now().toString(),
                clientId: formData.get('clientId'),
                type: formData.get('type'),
                name: formData.get('name'),
                testDate: formData.get('testDate'),
                results: results,
                notes: formData.get('notes'),
                createdAt: new Date().toISOString()
            };

            tests.push(test);
            storage.set('tests', tests);
            closeModal('testModal');
            renderTests();
            updateDashboard();
        }

        function saveNote(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            
            const note = {
                id: Date.now().toString(),
                clientId: formData.get('clientId'),
                title: formData.get('title'),
                content: formData.get('content'),
                createdAt: new Date().toISOString()
            };

            notes.push(note);
            storage.set('notes', notes);
            closeModal('noteModal');
            renderNotes();
            updateDashboard();
        }

        // Render functions
        function renderClients() {
            const list = document.getElementById('clientList');
            
            if (clients.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">👥</div>
                        <h3>No hay clientes registrados</h3>
                        <p>Comienza agregando tu primer cliente para empezar</p>
                    </div>
                `;
                return;
            }

            list.innerHTML = clients.map(client => {
                const initials = client.name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
                const clientPlans = plans.filter(p => p.clientId === client.id).length;
                const clientTests = tests.filter(t => t.clientId === client.id).length;
                
                return `
                    <div class="client-card" onclick="showClientDetail('${client.id}')">
                        <div class="client-avatar">${initials}</div>
                        <div class="client-name">${client.name}</div>
                        ${client.email ? `<div class="client-info">📧 ${client.email}</div>` : ''}
                        ${client.phone ? `<div class="client-info">📱 ${client.phone}</div>` : ''}
                        <div class="client-info">
                            ${client.age ? `${client.age} años` : ''} 
                            ${client.weight ? `• ${client.weight} kg` : ''} 
                            ${client.height ? `• ${client.height} cm` : ''}
                        </div>
                        ${client.goal ? `<div style="margin-top: 12px;"><span class="badge badge-primary">${getGoalLabel(client.goal)}</span></div>` : ''}
                        <div style="margin-top: 12px; display: flex; gap: 12px; font-size: 13px; color: var(--text-tertiary);">
                            <span>📋 ${clientPlans} planes</span>
                            <span>📈 ${clientTests} tests</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderPlans() {
            const list = document.getElementById('planList');
            
            if (plans.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">📋</div>
                        <h3>No hay planes de entrenamiento</h3>
                        <p>Crea planes personalizados para tus clientes</p>
                    </div>
                `;
                return;
            }

            list.innerHTML = plans.map(plan => {
                const client = clients.find(c => c.id === plan.clientId);
                return `
                    <div class="plan-card" id="plan-${plan.id}">
                        <div class="plan-header">
                            <div>
                                <div class="plan-title">${client ? client.name : 'Cliente no encontrado'}</div>
                                <div style="display: flex; gap: 8px; flex-wrap: wrap; margin-top: 8px;">
                                    <span class="badge badge-purple">${getPlanTypeLabel(plan.type)}</span>
                                    <span class="badge badge-success">${plan.duration} ${plan.duration === 1 ? 'Semana' : 'Semanas'}</span>
                                    ${plan.objective ? `<span class="badge badge-primary">${plan.objective}</span>` : ''}
                                </div>
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <button class="btn btn-secondary btn-icon" onclick="event.stopPropagation(); downloadPlan('${plan.id}')" title="Descargar/Imprimir">
                                    📥
                                </button>
                                <button class="btn btn-danger btn-icon" onclick="event.stopPropagation(); deletePlan('${plan.id}')">
                                    🗑️
                                </button>
                            </div>
                        </div>
                        
                        ${plan.description ? `<div style="color: var(--text-secondary); margin-bottom: 20px; line-height: 1.8;">${plan.description}</div>` : ''}
                        
                        ${plan.weeks && plan.weeks.length > 0 ? `
                            <div class="week-tabs" id="weekTabs-${plan.id}">
                                ${plan.weeks.map((w, i) => `
                                    <div class="week-tab ${i === 0 ? 'active' : ''}" onclick="showWeek('${plan.id}', ${i})">
                                        Semana ${w.week}
                                    </div>
                                `).join('')}
                            </div>
                            
                            <div id="weekContent-${plan.id}">
                                ${plan.weeks.map((week, weekIndex) => `
                                    <div class="week-content" id="week-${plan.id}-${weekIndex}" style="${weekIndex === 0 ? '' : 'display: none;'}">
                                        ${week.days.map(day => `
                                            <div class="day-section">
                                                <div class="day-title">${day.day}</div>
                                                <div style="color: var(--text-secondary); white-space: pre-wrap; line-height: 1.8;">${day.content}</div>
                                            </div>
                                        `).join('')}
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                        
                        ${plan.notes ? `
                            <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border-color);">
                                <div style="font-weight: 600; color: var(--accent-primary); margin-bottom: 8px;">Notas del Entrenador:</div>
                                <div style="color: var(--text-secondary); line-height: 1.8; white-space: pre-wrap;">${plan.notes}</div>
                            </div>
                        ` : ''}
                        
                        <div style="margin-top: 20px; font-size: 13px; color: var(--text-tertiary);">
                            Creado: ${new Date(plan.createdAt).toLocaleDateString('es-ES', { year: 'numeric', month: 'long', day: 'numeric' })}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function showWeek(planId, weekIndex) {
            // Update tabs
            const tabs = document.querySelectorAll(`#weekTabs-${planId} .week-tab`);
            tabs.forEach((tab, i) => {
                if (i === weekIndex) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });
            
            // Update content
            const contents = document.querySelectorAll(`[id^="week-${planId}-"]`);
            contents.forEach((content, i) => {
                content.style.display = i === weekIndex ? 'block' : 'none';
            });
        }

        function downloadPlan(planId) {
            const plan = plans.find(p => p.id === planId);
            if (!plan) return;
            
            const client = clients.find(c => c.id === plan.clientId);
            
            // Create printable HTML
            const printWindow = window.open('', '', 'width=800,height=600');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Plan de Entrenamiento - ${client?.name || 'Cliente'}</title>
                    <style>
                        * { margin: 0; padding: 0; box-sizing: border-box; }
                        body { font-family: Arial, sans-serif; padding: 40px; line-height: 1.6; }
                        h1 { color: #00d4ff; margin-bottom: 10px; }
                        h2 { color: #7c3aed; margin-top: 30px; margin-bottom: 15px; border-bottom: 2px solid #00d4ff; padding-bottom: 5px; }
                        h3 { color: #00d4ff; margin-top: 20px; margin-bottom: 10px; }
                        .header { margin-bottom: 30px; border-bottom: 3px solid #00d4ff; padding-bottom: 20px; }
                        .info { background: #f5f5f5; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
                        .info-item { margin-bottom: 8px; }
                        .info-label { font-weight: bold; color: #333; }
                        .day-section { margin-bottom: 20px; padding: 15px; background: #f9f9f9; border-left: 4px solid #00d4ff; border-radius: 4px; }
                        .day-title { font-weight: bold; color: #7c3aed; margin-bottom: 10px; font-size: 18px; }
                        .notes { background: #fff3cd; padding: 15px; border-radius: 8px; margin-top: 20px; border-left: 4px solid #f59e0b; }
                        .content { white-space: pre-wrap; }
                        @media print {
                            body { padding: 20px; }
                            .no-print { display: none; }
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>Plan de Entrenamiento</h1>
                        <div style="font-size: 18px; color: #666; margin-top: 10px;">
                            ${client?.name || 'Cliente no encontrado'}
                        </div>
                    </div>
                    
                    <div class="info">
                        <div class="info-item"><span class="info-label">Tipo de Plan:</span> ${getPlanTypeLabel(plan.type)}</div>
                        <div class="info-item"><span class="info-label">Duración:</span> ${plan.duration} ${plan.duration === 1 ? 'Semana' : 'Semanas'}</div>
                        ${plan.objective ? `<div class="info-item"><span class="info-label">Objetivo:</span> ${plan.objective}</div>` : ''}
                        <div class="info-item"><span class="info-label">Fecha de creación:</span> ${new Date(plan.createdAt).toLocaleDateString('es-ES', { year: 'numeric', month: 'long', day: 'numeric' })}</div>
                    </div>
                    
                    ${plan.description ? `
                        <div style="margin-bottom: 30px;">
                            <h2>Descripción General</h2>
                            <div class="content">${plan.description}</div>
                        </div>
                    ` : ''}
                    
                    ${plan.weeks && plan.weeks.length > 0 ? plan.weeks.map(week => `
                        <h2>Semana ${week.week}</h2>
                        ${week.days.map(day => `
                            <div class="day-section">
                                <div class="day-title">${day.day}</div>
                                <div class="content">${day.content}</div>
                            </div>
                        `).join('')}
                    `).join('') : ''}
                    
                    ${plan.notes ? `
                        <div class="notes">
                            <h3>Notas del Entrenador</h3>
                            <div class="content">${plan.notes}</div>
                        </div>
                    ` : ''}
                    
                    <div class="no-print" style="margin-top: 40px; text-align: center;">
                        <button onclick="window.print()" style="padding: 12px 24px; background: #00d4ff; color: white; border: none; border-radius: 8px; font-size: 16px; cursor: pointer;">
                            🖨️ Imprimir
                        </button>
                        <button onclick="window.close()" style="padding: 12px 24px; background: #666; color: white; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; margin-left: 10px;">
                            Cerrar
                        </button>
                    </div>
                </body>
                </html>
            `);
            printWindow.document.close();
        }

        function renderTests() {
            const list = document.getElementById('testList');
            
            if (tests.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">📈</div>
                        <h3>No hay tests registrados</h3>
                        <p>Registra evaluaciones y pruebas fitness de tus clientes</p>
                    </div>
                `;
                return;
            }

            list.innerHTML = tests.map(test => {
                const client = clients.find(c => c.clientId === test.clientId);
                return `
                    <div class="test-card">
                        <div class="test-header">
                            <div>
                                <div class="test-title">${test.name}</div>
                                <div style="color: var(--text-secondary); margin-top: 4px;">
                                    Cliente: ${client ? client.name : 'No encontrado'}
                                </div>
                                <div style="display: flex; gap: 8px; margin-top: 8px; flex-wrap: wrap;">
                                    <span class="badge badge-primary">${getTestTypeLabel(test.type)}</span>
                                    ${test.testDate ? `<span class="badge badge-success">📅 ${new Date(test.testDate).toLocaleDateString('es-ES')}</span>` : ''}
                                </div>
                            </div>
                            <button class="btn btn-danger btn-icon" onclick="deleteTest('${test.id}')">
                                🗑️
                            </button>
                        </div>
                        
                        ${Object.keys(test.results).length > 0 ? `
                            <div class="test-results">
                                <div style="font-weight: 700; color: var(--accent-primary); margin-bottom: 12px; font-size: 16px;">
                                    📊 Resultados
                                </div>
                                ${Object.entries(test.results).map(([label, value]) => `
                                    <div class="result-item">
                                        <span class="result-label">${label}</span>
                                        <span class="result-value">${value}</span>
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                        
                        ${test.notes ? `
                            <div style="margin-top: 16px; padding: 16px; background: var(--bg-secondary); border-radius: 12px; border-left: 4px solid var(--accent-secondary);">
                                <div style="font-weight: 600; color: var(--accent-secondary); margin-bottom: 8px;">Observaciones y Análisis:</div>
                                <div style="color: var(--text-secondary); line-height: 1.8; white-space: pre-wrap;">${test.notes}</div>
                            </div>
                        ` : ''}
                        
                        <div style="margin-top: 16px; font-size: 13px; color: var(--text-tertiary);">
                            Registrado: ${new Date(test.createdAt).toLocaleDateString('es-ES', { year: 'numeric', month: 'long', day: 'numeric' })}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderNotes() {
            const list = document.getElementById('noteList');
            
            if (notes.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">📝</div>
                        <h3>No hay notas guardadas</h3>
                        <p>Agrega notas importantes sobre tus clientes o entrenamientos</p>
                    </div>
                `;
                return;
            }

            list.innerHTML = notes.map(note => {
                const client = note.clientId ? clients.find(c => c.id === note.clientId) : null;
                return `
                    <div class="note-card">
                        <div class="note-header">
                            <div>
                                <div class="note-title">${note.title}</div>
                                ${client ? `<div style="color: var(--text-secondary); font-size: 14px; margin-top: 4px;">👤 ${client.name}</div>` : ''}
                            </div>
                            <button class="btn btn-danger btn-icon" onclick="deleteNote('${note.id}')">
                                🗑️
                            </button>
                        </div>
                        <div class="note-meta">
                            📅 ${new Date(note.createdAt).toLocaleDateString('es-ES', { year: 'numeric', month: 'long', day: 'numeric' })} 
                            • ${new Date(note.createdAt).toLocaleTimeString('es-ES', {hour: '2-digit', minute: '2-digit'})}
                        </div>
                        <div class="note-content">${note.content}</div>
                    </div>
                `;
            }).join('');
        }

        function showClientDetail(clientId) {
            const client = clients.find(c => c.id === clientId);
            if (!client) return;

            const clientPlans = plans.filter(p => p.clientId === clientId);
            const clientTests = tests.filter(t => t.clientId === clientId);
            const clientNotes = notes.filter(n => n.clientId === clientId);

            let bmi = '';
            if (client.weight && client.height) {
                const heightM = client.height / 100;
                const bmiValue = (client.weight / (heightM * heightM)).toFixed(1);
                bmi = `<div class="info-item"><span class="info-label">IMC:</span> ${bmiValue}</div>`;
            }

            document.getElementById('clientDetailName').textContent = client.name;
            document.getElementById('clientDetailContent').innerHTML = `
                <div class="info" style="background: var(--bg-secondary); padding: 20px; border-radius: 16px; margin-bottom: 24px; border: 1px solid var(--border-color);">
                    <h3 style="color: var(--accent-primary); margin-bottom: 16px; font-size: 18px;">Información Personal</h3>
                    <div style="display: grid; gap: 12px;">
                        ${client.email ? `<div class="info-item"><span class="info-label">📧 Email:</span> ${client.email}</div>` : ''}
                        ${client.phone ? `<div class="info-item"><span class="info-label">📱 Teléfono:</span> ${client.phone}</div>` : ''}
                        ${client.age ? `<div class="info-item"><span class="info-label">🎂 Edad:</span> ${client.age} años</div>` : ''}
                        ${client.weight ? `<div class="info-item"><span class="info-label">⚖️ Peso:</span> ${client.weight} kg</div>` : ''}
                        ${client.height ? `<div class="info-item"><span class="info-label">📏 Altura:</span> ${client.height} cm</div>` : ''}
                        ${bmi}
                        ${client.goal ? `<div class="info-item"><span class="info-label">🎯 Objetivo:</span> ${getGoalLabel(client.goal)}</div>` : ''}
                        ${client.notes ? `<div class="info-item" style="margin-top: 8px;"><span class="info-label">📝 Notas:</span><br><div style="margin-top: 8px; color: var(--text-secondary); white-space: pre-wrap;">${client.notes}</div></div>` : ''}
                    </div>
                </div>

                <div style="margin-bottom: 24px;">
                    <h3 style="color: var(--accent-primary); margin-bottom: 16px; font-size: 18px;">Estadísticas</h3>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;">
                        <div style="background: var(--bg-secondary); padding: 20px; border-radius: 12px; text-align: center; border: 1px solid var(--border-color);">
                            <div style="font-size: 32px; font-weight: 700; background: var(--accent-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">${clientPlans.length}</div>
                            <div style="font-size: 13px; color: var(--text-secondary); margin-top: 4px;">Planes</div>
                        </div>
                        <div style="background: var(--bg-secondary); padding: 20px; border-radius: 12px; text-align: center; border: 1px solid var(--border-color);">
                            <div style="font-size: 32px; font-weight: 700; background: var(--accent-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">${clientTests.length}</div>
                            <div style="font-size: 13px; color: var(--text-secondary); margin-top: 4px;">Tests</div>
                        </div>
                        <div style="background: var(--bg-secondary); padding: 20px; border-radius: 12px; text-align: center; border: 1px solid var(--border-color);">
                            <div style="font-size: 32px; font-weight: 700; background: var(--accent-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">${clientNotes.length}</div>
                            <div style="font-size: 13px; color: var(--text-secondary); margin-top: 4px;">Notas</div>
                        </div>
                    </div>
                </div>

                <div class="action-bar">
                    <button class="btn btn-primary" onclick="editClient('${clientId}')">✏️ Editar Cliente</button>
                    <button class="btn btn-danger" onclick="deleteClient('${clientId}')">🗑️ Eliminar Cliente</button>
                </div>
            `;

            document.getElementById('clientDetailModal').classList.add('active');
        }

        function editClient(clientId) {
            const client = clients.find(c => c.id === clientId);
            closeModal('clientDetailModal');
            openClientModal(client);
        }

        function deleteClient(clientId) {
            if (!confirm('¿Estás seguro de eliminar este cliente? También se eliminarán todos sus planes, tests y notas asociadas.')) return;
            
            clients = clients.filter(c => c.id !== clientId);
            plans = plans.filter(p => p.clientId !== clientId);
            tests = tests.filter(t => t.clientId !== clientId);
            notes = notes.filter(n => n.clientId !== clientId);
            
            storage.set('clients', clients);
            storage.set('plans', plans);
            storage.set('tests', tests);
            storage.set('notes', notes);
            
            closeModal('clientDetailModal');
            renderClients();
            updateDashboard();
        }

        function deletePlan(planId) {
            if (!confirm('¿Eliminar este plan de entrenamiento?')) return;
            plans = plans.filter(p => p.id !== planId);
            storage.set('plans', plans);
            renderPlans();
            updateDashboard();
        }

        function deleteTest(testId) {
            if (!confirm('¿Eliminar este test?')) return;
            tests = tests.filter(t => t.id !== testId);
            storage.set('tests', tests);
            renderTests();
            updateDashboard();
        }

        function deleteNote(noteId) {
            if (!confirm('¿Eliminar esta nota?')) return;
            notes = notes.filter(n => n.id !== noteId);
            storage.set('notes', notes);
            renderNotes();
            updateDashboard();
        }

        function updateClientSelects() {
            const selects = [
                document.getElementById('planClientSelect'),
                document.getElementById('testClientSelect'),
                document.getElementById('noteClientSelect')
            ];

            selects.forEach(select => {
                if (!select) return;
                const isNoteSelect = select.id === 'noteClientSelect';
                
                select.innerHTML = isNoteSelect 
                    ? '<option value="">Nota general (sin cliente asociado)</option>'
                    : '<option value="">Seleccionar cliente...</option>';
                
                clients.forEach(client => {
                    const option = document.createElement('option');
                    option.value = client.id;
                    option.textContent = client.name;
                    select.appendChild(option);
                });
            });
        }

        function updateDashboard() {
            document.getElementById('totalClients').textContent = clients.length;
            document.getElementById('totalPlans').textContent = plans.length;
            document.getElementById('totalTests').textContent = tests.length;
            document.getElementById('totalNotes').textContent = notes.length;

            const activity = document.getElementById('recentActivity');
            const allItems = [
                ...plans.map(p => ({...p, type: 'plan'})),
                ...tests.map(t => ({...t, type: 'test'})),
                ...notes.map(n => ({...n, type: 'note'})),
                ...clients.map(c => ({...c, type: 'client'}))
            ].sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt)).slice(0, 8);

            if (allItems.length === 0) {
                activity.innerHTML = `
                    <div class="empty-state" style="padding: 40px 20px;">
                        <div style="font-size: 48px; margin-bottom: 12px;">🚀</div>
                        <div style="color: var(--text-secondary);">No hay actividad reciente</div>
                        <div style="color: var(--text-tertiary); font-size: 14px; margin-top: 8px;">Comienza agregando clientes y creando planes</div>
                    </div>
                `;
                return;
            }

            activity.innerHTML = allItems.map(item => {
                const client = item.clientId ? clients.find(c => c.id === item.clientId) : null;
                let icon, label, title, color;
                
                if (item.type === 'plan') {
                    icon = '📋';
                    label = 'Plan de entrenamiento';
                    title = client ? client.name : 'Plan';
                    color = 'var(--accent-primary)';
                } else if (item.type === 'test') {
                    icon = '📈';
                    label = 'Test/Evaluación';
                    title = item.name;
                    color = 'var(--success)';
                } else if (item.type === 'note') {
                    icon = '📝';
                    label = 'Nota';
                    title = item.title;
                    color = 'var(--warning)';
                } else {
                    icon = '👤';
                    label = 'Nuevo cliente';
                    title = item.name;
                    color = 'var(--accent-secondary)';
                }

                return `
                    <div style="padding: 16px; background: var(--bg-secondary); border-radius: 12px; margin-bottom: 12px; border-left: 3px solid ${color}; transition: all 0.3s; cursor: pointer;" onmouseover="this.style.transform='translateX(4px)'" onmouseout="this.style.transform='translateX(0)'">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 4px; font-size: 15px;">
                                    ${icon} ${title}
                                </div>
                                <div style="font-size: 13px; color: var(--text-secondary);">
                                    ${label} ${client && item.type !== 'client' ? `• ${client.name}` : ''}
                                </div>
                            </div>
                            <div style="font-size: 12px; color: var(--text-tertiary); text-align: right;">
                                ${new Date(item.createdAt).toLocaleDateString('es-ES', { day: 'numeric', month: 'short' })}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Helper functions
        function getGoalLabel(goal) {
            const labels = {
                'perdida_peso': 'Pérdida de peso',
                'ganancia_muscular': 'Ganancia muscular',
                'resistencia': 'Resistencia',
                'fuerza': 'Fuerza',
                'rehabilitacion': 'Rehabilitación',
                'rendimiento': 'Rendimiento deportivo',
                'tonificacion': 'Tonificación',
                'otro': 'Otro'
            };
            return labels[goal] || goal;
        }

        function getPlanTypeLabel(type) {
            const labels = {
                'individual': 'Individual',
                'grupal': 'Grupal',
                'deportivo': 'Deportivo',
                'rehabilitacion': 'Rehabilitación',
                'fuerza': 'Fuerza',
                'hipertrofia': 'Hipertrofia',
                'resistencia': 'Resistencia',
                'funcional': 'Funcional'
            };
            return labels[type] || type;
        }

        function getTestTypeLabel(type) {
            const labels = {
                'composicion': 'Composición Corporal',
                'fuerza': 'Fuerza Máxima',
                'resistencia_muscular': 'Resistencia Muscular',
                'resistencia_cardio': 'Resistencia Cardiovascular',
                'flexibilidad': 'Flexibilidad',
                'velocidad': 'Velocidad/Agilidad',
                'potencia': 'Potencia',
                'antropometrico': 'Antropométrico',
                'funcional': 'Funcional',
                'otro': 'Otro'
            };
            return labels[type] || type;
        }

        // Initialize
        updateDashboard();
        renderClients();

        // Service Worker for offline functionality
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('data:text/javascript;base64,c2VsZi5hZGRFdmVudExpc3RlbmVyKCdpbnN0YWxsJywgZnVuY3Rpb24oZXZlbnQpIHsgc2VsZi5za2lwV2FpdGluZygpOyB9KTsgc2VsZi5hZGRFdmVudExpc3RlbmVyKCdmZXRjaCcsIGZ1bmN0aW9uKGV2ZW50KSB7IGV2ZW50LnJlc3BvbmRXaXRoKGZldGNoKGV2ZW50LnJlcXVlc3QpKTsgfSk7')
                .catch(() => {});
        }
    </script>
</body>
</html>                